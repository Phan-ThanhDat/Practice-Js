<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Funny</title>

    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">


</head>

<body>
<header class="header">
    <div class="view-range">
        <div class="content-header header__logo-name-company">
            <div class="header__logo">
                <i class="fas fa-link header__icon"></i>
            </div>
            <h3 class="header__name-company">Lord Software</h3>
        </div>
    </div>
</header>

<div class="list">
    <div class="view-range module-worker">
        <h3 class="list__name">List of particpants</h3>
        <div class="list__infos">
            <div class="list__row list__row--adding">
                <div class="content-input list__input-btn">
                    <form id="form-worker">
                        <div class="inputs">
                            <div class="input">
                                <input data-rules="required" name="fname" type="text" class="input__adding"
                                       placeholder="Full name">
                            </div>
                            <div class="input">
                                <input data-rules="required|email" name="email" type="email"
                                       class="input__adding input__adding--mail" placeholder="E-mail address">
                            </div>
                            <div class="input">
                                <input data-rules="required|tel" name="tel" type="tel" class="input__adding"
                                       placeholder="Phone number">
                            </div>
                        </div>
                        <button class="btn btn--add" type="submit">Add new</button>
                        <button class="btn btn--add" type="reset">Reset</button>
                    </form>
                </div>
            </div>
            <div class="list__infos">
                <table class="table">
                    <thead>
                    <tr>
                        <th>
                            <div class="list__t-name-icon">
                                <h3 class="title title--name">Name</h3>
                                <i class="fas fa-arrow-down list__t-icon"></i>
                            </div>
                        </th>
                        <th>
                            <h3 class="title title--mail">E-mail address</h3>
                        </th>
                        <th>
                            <h3 class="title title--tel">Phone number</h3>
                        </th>
                    </tr>
                    </thead>

                    <tbody>


                    </tbody>




                </table>




            </div>


        </div>
    </div>

</div>

<script>

    workersModule = (function () {

        function init() {
            validateFormWorker.init();
            dataTableWorker.init();
            validateFormWorker.onSubmitSuccess = function () {
                dataTableWorker.render();
            }
        }


        function unLoad() {

        }


        return {
            init: init,
            unLoad: unLoad,
        }

    })();


    // validate = new validateForm('form-worker');
    //
    // validate.reset();
    // validate.onSubmit(function (e) {
    //
    // });

    // validate.customValidatrion = {
    //     'checkPasswordLength' : function (value) {
    //
    //     }
    // }

    //


    validateFormWorker = (function () {
        let arraySave = [];

        var form = document.getElementById('form-worker');
        var btnSubmit = form.querySelector('button[type="submit"]');
        var inputs = form.querySelectorAll('input');
        let table = document.querySelector('.table');
        let display = table.querySelector('tbody');

        var inputStates = {
            uid : '',
            fname: {
                value: '',
                valid: false,
                errMessage: '',
            },
            email: {
                value: '',
                valid: false,
                errMessage: '',
            },
            tel: {
                value: '',
                valid: false,
                errMessage: '',
            }

        };

        function inputChange(e) {
            inputStates.uid = createUUID();
            inputStates[e.target.name].value = e.target.value;
            validateInput(e.target.name);
            //console.log(inputStates)
        }

        let createUUID = () => {
            // http://www.ietf.org/rfc/rfc4122.txt
            var s = [];
            var hexDigits = "0123456789abcdef";
            for (var i = 0; i < 36; i++) {
                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
            }
            s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
            s[8] = s[13] = s[18] = s[23] = "-";

            var uuid = s.join("");
            return uuid;
        }

            function validateInput(input) {
            switch (input) {
                case 'fname':
                    inputStates.fname.valid = Boolean(inputStates.fname.value);
                    if (!inputStates.fname.valid) {
                        inputStates.fname.errMessage = 'Not empty';
                    } else {
                        inputStates.fname.errMessage = '';
                    }
                    break;
                case 'email':

                    // sasasa
                    inputStates.email.valid = Boolean(inputStates.email.value);
                    if (!inputStates.email.valid) {
                        inputStates.email.errMessage = 'Not empty';
                    }
                    else if (!validateEmail(inputStates.email.value)) {
                        inputStates.email.errMessage = 'Email wrong';
                        inputStates.email.valid = false;
                    }
                    else {
                        inputStates.email.errMessage = '';
                    }
                    break;
                case 'tel':
                    inputStates.tel.valid = Boolean(inputStates.tel.value);
                    if (!inputStates.tel.valid) {
                        inputStates.tel.errMessage = 'Not empty';
                    }
                    else if (isPhoneNumber(inputStates.tel.value) && (inputStates.tel.valid)){
                        inputStates.tel.errMessage = '';
                    }
                    else if (!isPhoneNumber(inputStates.tel.value) || !(inputStates.tel.valid)) {
                        inputStates.tel.errMessage = 'phone wrong';
                        inputStates.tel.valid = false;
                    }
                    break;
            }

            renderInput(input);

        }

        function resetForm() {
            let fname1 = form.getElementsByClassName('input')[0];
            let fname2 = fname1.querySelector(`input[name="fname"]`).value ='';
            inputStates.fname.value = fname2.value;

            email1 = form.getElementsByClassName('input')[1];
            email2 = email1.querySelector(`input[name="email"]`).value ='';
            inputStates.email.value = email2.value;

            tel1 = form.getElementsByClassName('input')[2];
            tel2 = tel1.querySelector(`input[name="tel"]`).value ='';
            inputStates.tel.value = tel2.value;

            btnSubmit.disabled = true;
            btnSubmit.style.color = 'white'
        }


        function save2Localstorage() {
            let arraySaveString = [];
            let list = 'list';
            //inputStates.uid = new Date().getUTCMilliseconds();


            inputStates.fname.valid = Boolean(inputStates.fname.value);
            inputStates.email.valid = Boolean(inputStates.email.value);
            inputStates.tel.valid = Boolean(inputStates.tel.value);
            if(typeof (Storage) !=='undefined'){
                if (inputStates.fname.valid && inputStates.email.valid && inputStates.tel.valid) {
                    if(!localStorage.getItem(list)){
                        arraySave.push(inputStates);
                        arraySaveString = JSON.stringify(arraySave);
                        localStorage.setItem(list,arraySaveString);
                        localStorage[list] = arraySaveString;
                    }
                    else {
                        //get
                        arraySaveString =  localStorage.getItem(list);
                        arraySaveString = JSON.parse(arraySaveString);
                        //push
                        arraySaveString.push(inputStates);
                        //save to
                        arraySaveString = JSON.stringify(arraySaveString);
                        localStorage[list] = arraySaveString;
                    }
                }
            }
        }

        function save2LocalStorageNewList() {
            if(typeof (Storage) !=='undefined'){
                arraySave = JSON.stringify(arraySave);
                localStorage['list'] = arraySave;
            }

        }
        function displayVar() {
            arraySave = localStorage.getItem('list');
            arraySave = JSON.parse(arraySave);
//             arraySave.forEach(function (item) {
//                 document.getElementById('display').insertAdjacentHTML('afterbegin', `
// <h2> Title </h2>
//     <p>${item.title.value} </p>
// <h3> Content </h3>
//     <p> ${item.content.value} </p>
// __________________`);
//             });

            let listRemove = display;

            while(listRemove.hasChildNodes()) {
                listRemove.removeChild(listRemove.firstChild);
            }

            arraySave.forEach(function (item) {
                display.insertAdjacentHTML('afterbegin', `

<tr class="posts" data-uid="${item.uid}">

<td class="post">
<p class="info__text info__text--name">
${item.fname.value}
</p>
</td>

<td class="post">
<p class="info__text info__text--mail">
${item.email.value}
</p>
</td>

<td class="post">
<p class="info__text info__text--tel">
${item.tel.value}
</p>
</td>

<td>
<div class="list__cover-icons">
<i class="fas fa-pencil-alt info__icon"></i>
<i class="fas fa-trash info__icon"></i>
</div>
</td>

</tr>


`);

            });



        }
        function renderSubmit(e) {
            e.preventDefault();
            save2Localstorage();
            displayVar();
            resetForm();
        }

        function renderInput(input) {
            var inputSelector = form.querySelector(`input[name="${input}"]`);

            if (!inputStates[input].valid) {
                inputSelector.classList.add('input--error');
                let errorBox = inputSelector.parentElement.querySelector('.input__error');
                if(!errorBox) {
                    inputSelector.insertAdjacentHTML('afterend', `
                    <div class="input__error">${inputStates[input].errMessage}</div>
               `)
                } else {
                    errorBox.innerHTML = inputStates.email.errMessage;
                }

            } else if (inputSelector.classList.contains('input--error')) {
                inputSelector.classList.remove('input--error');
                inputSelector.parentElement.querySelector('.input__error').remove();
            }

            checkFormCanBeSubmit1();

        }
        //
        // function checkFormCanBeSubmit() {
        //
        //     var isReady = true;
        //     var obj = Object.keys(inputStates); // ['fname', 'tel']
        //
        //     for ( let i = 0; i < obj.length; i+=1){
        //         if (!inputStates[obj[i]].valid){
        //             isReady = false;
        //             break;
        //         }
        //     }
        //
        //     if(!isReady) {
        //         btnSubmit.disabled = true;
        //     } else {
        //         btnSubmit.disabled = false;
        //         btnSubmit.style.color = 'black';
        //     }
        //
        // }

        function checkFormCanBeSubmit1() {

            var isReady = true;
            inputStates.fname.valid = Boolean(inputStates.fname.value);
            inputStates.email.valid = Boolean(inputStates.email.value);
            inputStates.tel.valid = Boolean(inputStates.tel.value);

            if (!inputStates.tel.valid || !inputStates.email.valid || !inputStates.fname.valid){
                isReady = false;
            }

            if(!isReady) {
                btnSubmit.disabled = true;
                btnSubmit.style.color = 'white'
            } else if(isReady) {
                btnSubmit.disabled = false;
                btnSubmit.style.color = 'red'
            }
        }

        function validateEmail(mail) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) {
                return (true)
            }
            //alert("You have entered an invalid email address!")
            return (false)
        }

        let isPhoneNumber = input => {

            try {
                let ISD_CODES = [93, 355, 213, 1684, 376, 244, 1264, 672, 1268, 54, 374, 297, 61, 43, 994, 1242, 973, 880, 1246, 375, 32, 501, 229, 1441, 975, 591, 387, 267, 55, 246, 1284, 673, 359, 226, 257, 855, 237, 1, 238, 1345, 236, 235, 56, 86, 61, 61, 57, 269, 682, 506, 385, 53, 599, 357, 420, 243, 45, 253, 1767, 1809, 1829, 1849, 670, 593, 20, 503, 240, 291, 372, 251, 500, 298, 679, 358, 33, 689, 241, 220, 995, 49, 233, 350, 30, 299, 1473, 1671, 502, 441481, 224, 245, 592, 509, 504, 852, 36, 354, 91, 62, 98, 964, 353, 441624, 972, 39, 225, 1876, 81, 441534, 962, 7, 254, 686, 383, 965, 996, 856, 371, 961, 266, 231, 218, 423, 370, 352, 853, 389, 261, 265, 60, 960, 223, 356, 692, 222, 230, 262, 52, 691, 373, 377, 976, 382, 1664, 212, 258, 95, 264, 674, 977, 31, 599, 687, 64, 505, 227, 234, 683, 850, 1670, 47, 968, 92, 680, 970, 507, 675, 595, 51, 63, 64, 48, 351, 1787, 1939, 974, 242, 262, 40, 7, 250, 590, 290, 1869, 1758, 590, 508, 1784, 685, 378, 239, 966, 221, 381, 248, 232, 65, 1721, 421, 386, 677, 252, 27, 82, 211, 34, 94, 249, 597, 47, 268, 46, 41, 963, 886, 992, 255, 66, 228, 690, 676, 1868, 216, 90, 993, 1649, 688, 1340, 256, 380, 971, 44, 1, 598, 998, 678, 379, 58, 84, 681, 212, 967, 260, 263],
                    //extract numbers from string
                    thenum = input.match(/[0-9]/).join(""),
                    totalnums = thenum.length,
                    last10Digits = parseInt(thenum) % 10000000000,
                    ISDcode = thenum.substring(0, totalnums - 10);

                //phone numbers are generally of 8 to 16 digits
                if (totalnums >= 8 && totalnums <= 16) {
                    if (ISDcode) {
                        if (ISD_CODES.includes(parseInt(ISDcode))) {
                            return true;
                        } else {
                            return false;
                        }
                    } else {
                        return true;
                    }
                }
            } catch (e) {}

            return false;
        }

        function removeList(e) {
            let checkHasClass = e.target.parentElement;
            if (checkHasClass.classList.contains('fa-trash')){
                removeButton = e.target;
                postOfRemoveButton = removeButton.parentElement.parentElement.parentElement.parentElement;
                console.log(postOfRemoveButton);


                arraySave = localStorage.getItem('list');
                arraySave = JSON.parse(arraySave);

                console.log(arraySave);

                arraySave.forEach(function (item) {
                    if(item.uid === postOfRemoveButton.dataset.uid){
                        let index = arraySave.indexOf(item);

                        arraySave.splice(index, 1);

                        save2LocalStorageNewList();
                        displayVar();
                    }
                });
            }

        }

        function editList(e) {
            let checkHasClass = e.target.parentElement;
            if (checkHasClass.classList.contains('fa-pencil-alt')){
                let editButton = e.target;
                let postOfEditButton = editButton.parentElement.parentElement.parentElement.parentElement;
                postOfEditButton.style.display = 'none';

                let tableParticipants = document.querySelector('.table');
                tableParticipants.insertAdjacentHTML('afterend', `

<div class="list__row list__row--infos">
                    <form class="content-input list__edit-save">
                        <div class="inputs">
                            <input type="text" name="fname" class="input__editing" value="George Clooney">
                            <input type="email" name="email" class="input__editing input__editing--mail"
                                   value="george.clooney@hollywood.com">
                            <input type="tel" name="tel" class="input__editing" value="0504629898">
                        </div>

                        <button class="btn btn--cancel" type="reset">Cancel</button>
                        <button class="btn btn--save" type="submit">Save</button>

                    </form>
                </div>


`);

                if (document.querySelector('.list__edit-save')){
                    arraySave = localStorage.getItem('list');
                    arraySave = JSON.parse(arraySave) || [];

                    let contentInput = document.querySelector('.list__edit-save');
                    let inputs = contentInput.querySelectorAll('input');
                    arraySave.forEach(function (item) {
                        if(item.uid === postOfEditButton.dataset.uid){
                            let index = arraySave.indexOf(item);

                            contentInput.querySelectorAll('input')[0].value = '';
                            contentInput.querySelectorAll('input')[1].value = '';
                            contentInput.querySelectorAll('input')[2].value = '' ;

                            //inputStates = item;
                            console.log(inputStates);

                            inputs.forEach(function (inputt) {
                                inputt.addEventListener('input', function (e) {
                                    inputStates['uid'] = item.uid;
                                    console.log(e.target.name);
                                    inputStates[e.target.name].value = e.target.value;
                                });
                            });
                            console.log('checkingnnnnnnn')

                            inputStates.fname.valid = Boolean(inputStates.fname.value);
                            inputStates.email.valid = Boolean(inputStates.email.value);
                            inputStates.tel.valid = Boolean(inputStates.tel.value);

                            console.log(inputStates.fname.value)
                            console.log(inputStates);

                            console.log(arraySave[index]);

                            arraySave.splice(index, 1,inputStates);
                            // arraySave.splice(index, 0,inputStates);
                            //arraySave[index] = inputStates;

                            console.log(arraySave[index]);

                            let form = document.querySelector('.list__edit-save');
                            //save2LocalStorageNewList();
                            console.log(arraySave);



                            arraySave = JSON.stringify(arraySave) || '';
                            console.log(arraySave);
                            let demo = JSON.parse(arraySave)  || [];
                            console.log(demo);


                            form.addEventListener('submit',function (e) {
                                e.preventDefault();
                                save2LocalStorageNewList();
                                displayVar();
                            });
                        }
                    });
                }
            }
        }

        function init() {
            btnSubmit.disabled = true;
            arraySave = localStorage.getItem('list');
            arraySave = JSON.parse(arraySave) || [];

            if (arraySave.length > 0) {
                displayVar();
            }

            inputs.forEach(function (inputt) {
                inputt.addEventListener('input', inputChange)
            });
            form.addEventListener('submit',renderSubmit);
            display.addEventListener('click', editList);
            display.addEventListener('click',removeList);
        }

        function unLoad() {
            inputs.forEach(function (input) {
                input.removeEventListener('input', inputChange)
            });
            form.removeEventListener('submit',renderSubmit);
            display.removeEventListener('click', editList);
            display.removeEventListener('click',removeList);
        }


        return {
            init: init,
            unLoad: unLoad,
        }

    })();

    dataTableWorker = (function () {

        function init() {

        }


        return {
            init: init,
        }

    })();


    workersModule.init();
    workersModule.unLoad();



</script>
</body>

</html>