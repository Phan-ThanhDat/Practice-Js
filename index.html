<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Funny</title>

    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">


</head>

<body>
<header class="header">
    <div class="view-range">
        <div class="content-header header__logo-name-company">
            <div class="header__logo">
                <i class="fas fa-link header__icon"></i>
            </div>
            <h3 class="header__name-company">Lord Software</h3>
        </div>
    </div>
</header>

<div class="list">
    <div class="view-range module-worker">
        <h3 class="list__name">List of particpants</h3>
        <div class="list__infos">
            <div class="list__row list__row--adding">
                <div class="content-input list__input-btn">
                    <form id="form-worker">
                        <div class="inputs">
                            <div class="input">
                                <input data-rules="required" name="fname" type="text" class="input__adding"
                                       placeholder="Full name">
                            </div>
                            <div class="input">
                                <input data-rules="required|email" name="email" type="email"
                                       class="input__adding input__adding--mail" placeholder="E-mail address">
                            </div>
                            <div class="input">
                                <input data-rules="required|tel" name="tel" type="tel" class="input__adding"
                                       placeholder="Phone number">
                            </div>
                        </div>
                        <button class="btn btn--add" type="submit">Add new</button>
                        <button class="btn btn--add" type="reset">Reset</button>
                    </form>
                </div>
            </div>
            <div class="list__infos">
                <table class="table">
                    <thead>
                    <tr>
                        <th>
                            <div class="list__t-name-icon">
                                <h3 class="title title--name">Name</h3>
                                <i class="fas fa-arrow-down list__t-icon"></i>
                            </div>
                        </th>
                        <th>
                            <h3 class="title title--mail">E-mail address</h3>
                        </th>
                        <th>
                            <h3 class="title title--tel">Phone number</h3>
                        </th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr>
                        <td>
                            <p class="info__text info__text--name">Joe Doe</p>
                        </td>
                        <td>
                            <p class="info__text info__text--mail">john.doe@gmail.com</p>
                        </td>
                        <td>
                            <p class="info__text info__text--tel">0405678471</p>
                        </td>
                        <td>
                            <div class="list__cover-icons">
                                <i class="fas fa-pencil-alt info__icon"></i>
                                <i class="fas fa-trash info__icon"></i>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="info__text info__text--name">George Clooney</p>
                        </td>
                        <td>
                            <p class="info__text info__text--mail">george.clooney@hollywood.com</p>
                        </td>
                        <td>
                            <p class="info__text info__text--tel">0504629898</p>
                        </td>
                        <td>
                            <div class="list__cover-icons">
                                <i class="fas fa-pencil-alt info__icon"></i>
                                <i class="fas fa-trash info__icon"></i>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="info__text info__text--name"> Clooney</p>
                        </td>
                        <td>
                            <p class="info__text info__text--mail">george.clooney@hollywood.com</p>
                        </td>
                        <td>
                            <p class="info__text info__text--tel">0504629898</p>
                        </td>
                        <td>
                            <div class="list__cover-icons">
                                <i class="fas fa-pencil-alt info__icon"></i>
                                <i class="fas fa-trash info__icon"></i>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="info__text info__text--name"> Clooney</p>
                        </td>
                        <td>
                            <p class="info__text info__text--mail">george.clooney@hollywood.com</p>
                        </td>
                        <td>
                            <p class="info__text info__text--tel">0504629898</p>
                        </td>
                        <td>
                            <div class="list__cover-icons">
                                <i class="fas fa-pencil-alt info__icon"></i>
                                <i class="fas fa-trash info__icon"></i>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="list__row list__row--infos">
                <div class="content-input list__edit-save">
                    <div class="input">
                        <input type="text" class="input__editing" value="George Clooney">
                        <input type="email" class="input__editing input__editing--mail"
                               value="george.clooney@hollywood.com">
                        <input type="tel" class="input__editing" value="0504629898">
                    </div>
                    <div class="list__btn">
                        <button class="btn btn--cancel">Cancel</button>
                        <button class="btn btn--save">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="list">
        <ul>
            <li class="list-item" data-animal-code="dog" data-id="1">salsla</li>
            <li class="list-item">Cat</li>
            <li class="list-item">Rat</li>
        </ul>
    </div>
</div>

<script>

    workersModule = (function () {

        function init() {
            validateFormWorker.init();
            dataTableWorker.init();
            validateFormWorker.onSubmitSuccess = function () {
                dataTableWorker.render();
            }
        }


        function unLoad() {

        }


        return {
            init: init,
            unLoad: unLoad,
        }

    })();


    // validate = new validateForm('form-worker');
    //
    // validate.reset();
    // validate.onSubmit(function (e) {
    //
    // });

    // validate.customValidatrion = {
    //     'checkPasswordLength' : function (value) {
    //
    //     }
    // }

    //


    validateFormWorker = (function () {
        let arraySave = [];

        var form = document.getElementById('form-worker');
        var btnSubmit = form.querySelector('button[type="submit"]');
        var inputs = form.querySelectorAll('input');


        var inputStates = {
            fname: {
                value: '',
                valid: false,
                errMessage: '',
            },
            email: {
                value: '',
                valid: false,
                errMessage: '',
            },
            tel: {
                value: '',
                valid: false,
                errMessage: '',
            }

        };

        function inputChange(e) {
            inputStates[e.target.name].value = e.target.value;
            validateInput(e.target.name);
            //console.log(inputStates)
        }


        function validateInput(input) {
            switch (input) {
                case 'fname':
                    inputStates.fname.valid = Boolean(inputStates.fname.value);
                    if (!inputStates.fname.valid) {
                        inputStates.fname.errMessage = 'Not empty';
                    } else {
                        inputStates.fname.errMessage = '';
                    }
                    break;
                case 'email':

                    // sasasa
                    inputStates.email.valid = Boolean(inputStates.email.value);
                    if (!inputStates.email.valid) {
                        inputStates.email.errMessage = 'Not empty';
                    }
                    else if (!validateEmail(inputStates.email.value)) {
                        inputStates.email.errMessage = 'Email wrong';
                        inputStates.email.valid = false;
                    }
                    else {
                        inputStates.email.errMessage = '';
                    }

                    break;
                case 'tel':
                    inputStates.tel.valid = Boolean(inputStates.tel.value);
                    if (!inputStates.tel.valid) {
                        inputStates.tel.errMessage = 'Not empty';
                    } else {
                        inputStates.tel.errMessage = '';
                    }
                    break;
            }

            renderInput(input);

        }
        
        function resetForm() {
            fname1 = form.getElementsByClassName('input')[0];
            fname2 = fname1.querySelector(`input[name="fname"]`).value ='';
            inputStates.fname.value = fname2.value;

            email1 = form.getElementsByClassName('input')[1];
            email2 = email1.querySelector(`input[name="email"]`).value ='';
            inputStates.email.value = email2.value;

            tel1 = form.getElementsByClassName('input')[2];
            tel2 = tel1.querySelector(`input[name="tel"]`).value ='';
            inputStates.tel.value = tel2.value;

            btnSubmit.disabled = true;
            btnSubmit.style.color = 'white'
        }


        function save2Localstorage() {
            let arraySaveString = [];
            let list = 'list';
            if(typeof (Storage) !=='undefined'){

                if(!localStorage.getItem(list)){
                    arraySave.push(inputStates);
                    arraySaveString = JSON.stringify(arraySave);
                    localStorage.setItem(list,arraySaveString);
                    localStorage[list] = arraySaveString;
                }
                else {
                    arraySaveString =  localStorage.getItem(list);
                    arraySaveString = JSON.parse(arraySaveString);
                    arraySaveString.push(inputStates);
                    arraySaveString = JSON.stringify(arraySaveString);
                    localStorage[list] = arraySaveString;
                }

            }
        }
        function displayVar(e) {
            save2Localstorage();
            arraySave = localStorage.getItem('list');
            arraySave = JSON.parse(arraySave);
            console.log(arraySave);
//             arraySave.forEach(function (item) {
//                 document.getElementById('display').insertAdjacentHTML('afterbegin', `
// <h2> Title </h2>
//     <p>${item.title.value} </p>
// <h3> Content </h3>
//     <p> ${item.content.value} </p>
// __________________`);
//             });
            table = document.querySelector('.table');
            display = table.querySelector('tbody');
            let listRemove = display;

            while(listRemove.hasChildNodes()) {
                listRemove.removeChild(listRemove.firstChild);
            }

            arraySave.forEach(function (item) {
                display.insertAdjacentHTML('afterbegin', `

<tr class="posts">

<td class="post">
<p class="info__text info__text--name">
${item.fname.value}
</p>
</td>

<td class="post">
<p class="info__text info__text--mail">
${item.email.value}
</p>
</td>

<td class="post">
<p class="info__text info__text--tel">
${item.tel.value}
</p>
</td>

<td>
<div class="list__cover-icons">
<i class="fas fa-pencil-alt info__icon"></i>
<i class="fas fa-trash info__icon"></i>
</div>
</td>

</tr>

<p>hahahahah</p>

`);
                console.log(item);
            });


            e.preventDefault();
            resetForm();
        }

        function renderInput(input) {
            var inputSelector = form.querySelector(`input[name="${input}"]`);

            if (!inputStates[input].valid) {
                inputSelector.classList.add('input--error');
                let errorBox = inputSelector.parentElement.querySelector('.input__error');
                if(!errorBox) {
                    inputSelector.insertAdjacentHTML('afterend', `
                    <div class="input__error">${inputStates[input].errMessage}</div>
               `)
                } else {
                    errorBox.innerHTML = inputStates.email.errMessage;
                }

            } else if (inputSelector.classList.contains('input--error')) {
                inputSelector.classList.remove('input--error');
                inputSelector.parentElement.querySelector('.input__error').remove();
            }

            checkFormCanBeSubmit();

        }

        function checkFormCanBeSubmit() {

            var isReady = true;
            var obj = Object.keys(inputStates); // ['fname', 'tel']

            for ( let i = 0; i < obj.length; i+=1){
                if (!inputStates[obj[i]].valid){
                    isReady = false;
                    break;
                }
            }

            if(!isReady && !btnSubmit.disabled) {
                btnSubmit.disabled = true;
            } else {
                btnSubmit.disabled = false;
            }

        }



        function validateEmail(mail) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) {
                return (true)
            }
            //alert("You have entered an invalid email address!")
            return (false)
        }

        function init() {
            btnSubmit.disabled = true;
            inputs.forEach(function (inputt) {
                inputt.addEventListener('input', inputChange)
            })
            form.addEventListener('submit',displayVar);


        }

        function unLoad() {
            inputs.forEach(function (input) {
                input.removeEventListener('input', inputChange)
            });
        }


        return {
            init: init,
            unLoad: unLoad,
        }

    })();

    dataTableWorker = (function () {

        function init() {

        }


        return {
            init: init,
        }

    })();


    workersModule.init();



</script>
</body>

</html>